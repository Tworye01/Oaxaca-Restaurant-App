<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Source: listen.go in package github.com/gofiber/fiber/v2</title>
<link href="../../../../../css/dark-v0.6.8.css" rel="stylesheet">
<script src="../../../../../jvs/golds-v0.6.8.js"></script>
<body onload="onPageLoad()"><div>

<pre id="header"><code><span class="title">Source File</span>
	listen.go

<span class="title">Belonging Package</span>
	<a href="../../../../../pkg/github.com/gofiber/fiber/v2.html">github.com/gofiber/fiber/v2</a>
</code></pre>

<pre class="line-numbers">
<span class="codeline" id="line-1"><code>// ‚ö°Ô∏è Fiber is an Express inspired web framework written in Go with ‚òïÔ∏è</code></span>
<span class="codeline" id="line-2"><code>// ü§ñ Github Repository: https://github.com/gofiber/fiber</code></span>
<span class="codeline" id="line-3"><code>// üìå API Documentation: https://docs.gofiber.io</code></span>
<span class="codeline" id="line-4"><code></code></span>
<span class="codeline" id="line-5"><code>package fiber</code></span>
<span class="codeline" id="line-6"><code></code></span>
<span class="codeline" id="line-7"><code>import (</code></span>
<span class="codeline" id="line-8"><code>	"crypto/tls"</code></span>
<span class="codeline" id="line-9"><code>	"crypto/x509"</code></span>
<span class="codeline" id="line-10"><code>	"errors"</code></span>
<span class="codeline" id="line-11"><code>	"fmt"</code></span>
<span class="codeline" id="line-12"><code>	"net"</code></span>
<span class="codeline" id="line-13"><code>	"os"</code></span>
<span class="codeline" id="line-14"><code>	"path/filepath"</code></span>
<span class="codeline" id="line-15"><code>	"reflect"</code></span>
<span class="codeline" id="line-16"><code>	"runtime"</code></span>
<span class="codeline" id="line-17"><code>	"sort"</code></span>
<span class="codeline" id="line-18"><code>	"strconv"</code></span>
<span class="codeline" id="line-19"><code>	"strings"</code></span>
<span class="codeline" id="line-20"><code>	"text/tabwriter"</code></span>
<span class="codeline" id="line-21"><code></code></span>
<span class="codeline" id="line-22"><code>	"github.com/mattn/go-colorable"</code></span>
<span class="codeline" id="line-23"><code>	"github.com/mattn/go-isatty"</code></span>
<span class="codeline" id="line-24"><code>	"github.com/mattn/go-runewidth"</code></span>
<span class="codeline" id="line-25"><code></code></span>
<span class="codeline" id="line-26"><code>	"github.com/gofiber/fiber/v2/log"</code></span>
<span class="codeline" id="line-27"><code>)</code></span>
<span class="codeline" id="line-28"><code></code></span>
<span class="codeline" id="line-29"><code>const (</code></span>
<span class="codeline" id="line-30"><code>	globalIpv4Addr = "0.0.0.0"</code></span>
<span class="codeline" id="line-31"><code>)</code></span>
<span class="codeline" id="line-32"><code></code></span>
<span class="codeline" id="line-33"><code>// Listener can be used to pass a custom listener.</code></span>
<span class="codeline" id="line-34"><code>func (app *App) Listener(ln net.Listener) error {</code></span>
<span class="codeline" id="line-35"><code>	// prepare the server for the start</code></span>
<span class="codeline" id="line-36"><code>	app.startupProcess()</code></span>
<span class="codeline" id="line-37"><code></code></span>
<span class="codeline" id="line-38"><code>	// run hooks</code></span>
<span class="codeline" id="line-39"><code>	app.runOnListenHooks(app.prepareListenData(ln.Addr().String(), getTLSConfig(ln) != nil))</code></span>
<span class="codeline" id="line-40"><code></code></span>
<span class="codeline" id="line-41"><code>	// Print startup message</code></span>
<span class="codeline" id="line-42"><code>	if !app.config.DisableStartupMessage {</code></span>
<span class="codeline" id="line-43"><code>		app.startupMessage(ln.Addr().String(), getTLSConfig(ln) != nil, "")</code></span>
<span class="codeline" id="line-44"><code>	}</code></span>
<span class="codeline" id="line-45"><code></code></span>
<span class="codeline" id="line-46"><code>	// Print routes</code></span>
<span class="codeline" id="line-47"><code>	if app.config.EnablePrintRoutes {</code></span>
<span class="codeline" id="line-48"><code>		app.printRoutesMessage()</code></span>
<span class="codeline" id="line-49"><code>	}</code></span>
<span class="codeline" id="line-50"><code></code></span>
<span class="codeline" id="line-51"><code>	// Prefork is not supported for custom listeners</code></span>
<span class="codeline" id="line-52"><code>	if app.config.Prefork {</code></span>
<span class="codeline" id="line-53"><code>		log.Warn("Prefork isn't supported for custom listeners.")</code></span>
<span class="codeline" id="line-54"><code>	}</code></span>
<span class="codeline" id="line-55"><code></code></span>
<span class="codeline" id="line-56"><code>	// Start listening</code></span>
<span class="codeline" id="line-57"><code>	return app.server.Serve(ln)</code></span>
<span class="codeline" id="line-58"><code>}</code></span>
<span class="codeline" id="line-59"><code></code></span>
<span class="codeline" id="line-60"><code>// Listen serves HTTP requests from the given addr.</code></span>
<span class="codeline" id="line-61"><code>//</code></span>
<span class="codeline" id="line-62"><code>//	app.Listen(":8080")</code></span>
<span class="codeline" id="line-63"><code>//	app.Listen("127.0.0.1:8080")</code></span>
<span class="codeline" id="line-64"><code>func (app *App) Listen(addr string) error {</code></span>
<span class="codeline" id="line-65"><code>	// Start prefork</code></span>
<span class="codeline" id="line-66"><code>	if app.config.Prefork {</code></span>
<span class="codeline" id="line-67"><code>		return app.prefork(app.config.Network, addr, nil)</code></span>
<span class="codeline" id="line-68"><code>	}</code></span>
<span class="codeline" id="line-69"><code></code></span>
<span class="codeline" id="line-70"><code>	// Setup listener</code></span>
<span class="codeline" id="line-71"><code>	ln, err := net.Listen(app.config.Network, addr)</code></span>
<span class="codeline" id="line-72"><code>	if err != nil {</code></span>
<span class="codeline" id="line-73"><code>		return fmt.Errorf("failed to listen: %w", err)</code></span>
<span class="codeline" id="line-74"><code>	}</code></span>
<span class="codeline" id="line-75"><code></code></span>
<span class="codeline" id="line-76"><code>	// prepare the server for the start</code></span>
<span class="codeline" id="line-77"><code>	app.startupProcess()</code></span>
<span class="codeline" id="line-78"><code></code></span>
<span class="codeline" id="line-79"><code>	// run hooks</code></span>
<span class="codeline" id="line-80"><code>	app.runOnListenHooks(app.prepareListenData(ln.Addr().String(), false))</code></span>
<span class="codeline" id="line-81"><code></code></span>
<span class="codeline" id="line-82"><code>	// Print startup message</code></span>
<span class="codeline" id="line-83"><code>	if !app.config.DisableStartupMessage {</code></span>
<span class="codeline" id="line-84"><code>		app.startupMessage(ln.Addr().String(), false, "")</code></span>
<span class="codeline" id="line-85"><code>	}</code></span>
<span class="codeline" id="line-86"><code></code></span>
<span class="codeline" id="line-87"><code>	// Print routes</code></span>
<span class="codeline" id="line-88"><code>	if app.config.EnablePrintRoutes {</code></span>
<span class="codeline" id="line-89"><code>		app.printRoutesMessage()</code></span>
<span class="codeline" id="line-90"><code>	}</code></span>
<span class="codeline" id="line-91"><code></code></span>
<span class="codeline" id="line-92"><code>	// Start listening</code></span>
<span class="codeline" id="line-93"><code>	return app.server.Serve(ln)</code></span>
<span class="codeline" id="line-94"><code>}</code></span>
<span class="codeline" id="line-95"><code></code></span>
<span class="codeline" id="line-96"><code>// ListenTLS serves HTTPS requests from the given addr.</code></span>
<span class="codeline" id="line-97"><code>// certFile and keyFile are the paths to TLS certificate and key file:</code></span>
<span class="codeline" id="line-98"><code>//</code></span>
<span class="codeline" id="line-99"><code>//	app.ListenTLS(":8080", "./cert.pem", "./cert.key")</code></span>
<span class="codeline" id="line-100"><code>func (app *App) ListenTLS(addr, certFile, keyFile string) error {</code></span>
<span class="codeline" id="line-101"><code>	// Check for valid cert/key path</code></span>
<span class="codeline" id="line-102"><code>	if len(certFile) == 0 || len(keyFile) == 0 {</code></span>
<span class="codeline" id="line-103"><code>		return errors.New("tls: provide a valid cert or key path")</code></span>
<span class="codeline" id="line-104"><code>	}</code></span>
<span class="codeline" id="line-105"><code></code></span>
<span class="codeline" id="line-106"><code>	// Set TLS config with handler</code></span>
<span class="codeline" id="line-107"><code>	cert, err := tls.LoadX509KeyPair(certFile, keyFile)</code></span>
<span class="codeline" id="line-108"><code>	if err != nil {</code></span>
<span class="codeline" id="line-109"><code>		return fmt.Errorf("tls: cannot load TLS key pair from certFile=%q and keyFile=%q: %w", certFile, keyFile, err)</code></span>
<span class="codeline" id="line-110"><code>	}</code></span>
<span class="codeline" id="line-111"><code></code></span>
<span class="codeline" id="line-112"><code>	return app.ListenTLSWithCertificate(addr, cert)</code></span>
<span class="codeline" id="line-113"><code>}</code></span>
<span class="codeline" id="line-114"><code></code></span>
<span class="codeline" id="line-115"><code>// ListenTLS serves HTTPS requests from the given addr.</code></span>
<span class="codeline" id="line-116"><code>// cert is a tls.Certificate</code></span>
<span class="codeline" id="line-117"><code>//</code></span>
<span class="codeline" id="line-118"><code>//	app.ListenTLSWithCertificate(":8080", cert)</code></span>
<span class="codeline" id="line-119"><code>func (app *App) ListenTLSWithCertificate(addr string, cert tls.Certificate) error {</code></span>
<span class="codeline" id="line-120"><code>	tlsHandler := &amp;TLSHandler{}</code></span>
<span class="codeline" id="line-121"><code>	config := &amp;tls.Config{</code></span>
<span class="codeline" id="line-122"><code>		MinVersion: tls.VersionTLS12,</code></span>
<span class="codeline" id="line-123"><code>		Certificates: []tls.Certificate{</code></span>
<span class="codeline" id="line-124"><code>			cert,</code></span>
<span class="codeline" id="line-125"><code>		},</code></span>
<span class="codeline" id="line-126"><code>		GetCertificate: tlsHandler.GetClientInfo,</code></span>
<span class="codeline" id="line-127"><code>	}</code></span>
<span class="codeline" id="line-128"><code></code></span>
<span class="codeline" id="line-129"><code>	// Prefork is supported</code></span>
<span class="codeline" id="line-130"><code>	if app.config.Prefork {</code></span>
<span class="codeline" id="line-131"><code>		return app.prefork(app.config.Network, addr, config)</code></span>
<span class="codeline" id="line-132"><code>	}</code></span>
<span class="codeline" id="line-133"><code></code></span>
<span class="codeline" id="line-134"><code>	// Setup listener</code></span>
<span class="codeline" id="line-135"><code>	ln, err := net.Listen(app.config.Network, addr)</code></span>
<span class="codeline" id="line-136"><code>	ln = tls.NewListener(ln, config)</code></span>
<span class="codeline" id="line-137"><code>	if err != nil {</code></span>
<span class="codeline" id="line-138"><code>		return fmt.Errorf("failed to listen: %w", err)</code></span>
<span class="codeline" id="line-139"><code>	}</code></span>
<span class="codeline" id="line-140"><code></code></span>
<span class="codeline" id="line-141"><code>	// prepare the server for the start</code></span>
<span class="codeline" id="line-142"><code>	app.startupProcess()</code></span>
<span class="codeline" id="line-143"><code></code></span>
<span class="codeline" id="line-144"><code>	// run hooks</code></span>
<span class="codeline" id="line-145"><code>	app.runOnListenHooks(app.prepareListenData(ln.Addr().String(), getTLSConfig(ln) != nil))</code></span>
<span class="codeline" id="line-146"><code></code></span>
<span class="codeline" id="line-147"><code>	// Print startup message</code></span>
<span class="codeline" id="line-148"><code>	if !app.config.DisableStartupMessage {</code></span>
<span class="codeline" id="line-149"><code>		app.startupMessage(ln.Addr().String(), true, "")</code></span>
<span class="codeline" id="line-150"><code>	}</code></span>
<span class="codeline" id="line-151"><code></code></span>
<span class="codeline" id="line-152"><code>	// Print routes</code></span>
<span class="codeline" id="line-153"><code>	if app.config.EnablePrintRoutes {</code></span>
<span class="codeline" id="line-154"><code>		app.printRoutesMessage()</code></span>
<span class="codeline" id="line-155"><code>	}</code></span>
<span class="codeline" id="line-156"><code></code></span>
<span class="codeline" id="line-157"><code>	// Attach the tlsHandler to the config</code></span>
<span class="codeline" id="line-158"><code>	app.SetTLSHandler(tlsHandler)</code></span>
<span class="codeline" id="line-159"><code></code></span>
<span class="codeline" id="line-160"><code>	// Start listening</code></span>
<span class="codeline" id="line-161"><code>	return app.server.Serve(ln)</code></span>
<span class="codeline" id="line-162"><code>}</code></span>
<span class="codeline" id="line-163"><code></code></span>
<span class="codeline" id="line-164"><code>// ListenMutualTLS serves HTTPS requests from the given addr.</code></span>
<span class="codeline" id="line-165"><code>// certFile, keyFile and clientCertFile are the paths to TLS certificate and key file:</code></span>
<span class="codeline" id="line-166"><code>//</code></span>
<span class="codeline" id="line-167"><code>//	app.ListenMutualTLS(":8080", "./cert.pem", "./cert.key", "./client.pem")</code></span>
<span class="codeline" id="line-168"><code>func (app *App) ListenMutualTLS(addr, certFile, keyFile, clientCertFile string) error {</code></span>
<span class="codeline" id="line-169"><code>	// Check for valid cert/key path</code></span>
<span class="codeline" id="line-170"><code>	if len(certFile) == 0 || len(keyFile) == 0 {</code></span>
<span class="codeline" id="line-171"><code>		return errors.New("tls: provide a valid cert or key path")</code></span>
<span class="codeline" id="line-172"><code>	}</code></span>
<span class="codeline" id="line-173"><code></code></span>
<span class="codeline" id="line-174"><code>	cert, err := tls.LoadX509KeyPair(certFile, keyFile)</code></span>
<span class="codeline" id="line-175"><code>	if err != nil {</code></span>
<span class="codeline" id="line-176"><code>		return fmt.Errorf("tls: cannot load TLS key pair from certFile=%q and keyFile=%q: %w", certFile, keyFile, err)</code></span>
<span class="codeline" id="line-177"><code>	}</code></span>
<span class="codeline" id="line-178"><code></code></span>
<span class="codeline" id="line-179"><code>	clientCACert, err := os.ReadFile(filepath.Clean(clientCertFile))</code></span>
<span class="codeline" id="line-180"><code>	if err != nil {</code></span>
<span class="codeline" id="line-181"><code>		return fmt.Errorf("failed to read file: %w", err)</code></span>
<span class="codeline" id="line-182"><code>	}</code></span>
<span class="codeline" id="line-183"><code>	clientCertPool := x509.NewCertPool()</code></span>
<span class="codeline" id="line-184"><code>	clientCertPool.AppendCertsFromPEM(clientCACert)</code></span>
<span class="codeline" id="line-185"><code></code></span>
<span class="codeline" id="line-186"><code>	return app.ListenMutualTLSWithCertificate(addr, cert, clientCertPool)</code></span>
<span class="codeline" id="line-187"><code>}</code></span>
<span class="codeline" id="line-188"><code></code></span>
<span class="codeline" id="line-189"><code>// ListenMutualTLSWithCertificate serves HTTPS requests from the given addr.</code></span>
<span class="codeline" id="line-190"><code>// cert is a tls.Certificate and clientCertPool is a *x509.CertPool:</code></span>
<span class="codeline" id="line-191"><code>//</code></span>
<span class="codeline" id="line-192"><code>//	app.ListenMutualTLS(":8080", cert, clientCertPool)</code></span>
<span class="codeline" id="line-193"><code>func (app *App) ListenMutualTLSWithCertificate(addr string, cert tls.Certificate, clientCertPool *x509.CertPool) error {</code></span>
<span class="codeline" id="line-194"><code>	tlsHandler := &amp;TLSHandler{}</code></span>
<span class="codeline" id="line-195"><code>	config := &amp;tls.Config{</code></span>
<span class="codeline" id="line-196"><code>		MinVersion: tls.VersionTLS12,</code></span>
<span class="codeline" id="line-197"><code>		ClientAuth: tls.RequireAndVerifyClientCert,</code></span>
<span class="codeline" id="line-198"><code>		ClientCAs:  clientCertPool,</code></span>
<span class="codeline" id="line-199"><code>		Certificates: []tls.Certificate{</code></span>
<span class="codeline" id="line-200"><code>			cert,</code></span>
<span class="codeline" id="line-201"><code>		},</code></span>
<span class="codeline" id="line-202"><code>		GetCertificate: tlsHandler.GetClientInfo,</code></span>
<span class="codeline" id="line-203"><code>	}</code></span>
<span class="codeline" id="line-204"><code></code></span>
<span class="codeline" id="line-205"><code>	// Prefork is supported</code></span>
<span class="codeline" id="line-206"><code>	if app.config.Prefork {</code></span>
<span class="codeline" id="line-207"><code>		return app.prefork(app.config.Network, addr, config)</code></span>
<span class="codeline" id="line-208"><code>	}</code></span>
<span class="codeline" id="line-209"><code></code></span>
<span class="codeline" id="line-210"><code>	// Setup listener</code></span>
<span class="codeline" id="line-211"><code>	ln, err := tls.Listen(app.config.Network, addr, config)</code></span>
<span class="codeline" id="line-212"><code>	if err != nil {</code></span>
<span class="codeline" id="line-213"><code>		return fmt.Errorf("failed to listen: %w", err)</code></span>
<span class="codeline" id="line-214"><code>	}</code></span>
<span class="codeline" id="line-215"><code></code></span>
<span class="codeline" id="line-216"><code>	// prepare the server for the start</code></span>
<span class="codeline" id="line-217"><code>	app.startupProcess()</code></span>
<span class="codeline" id="line-218"><code></code></span>
<span class="codeline" id="line-219"><code>	// run hooks</code></span>
<span class="codeline" id="line-220"><code>	app.runOnListenHooks(app.prepareListenData(ln.Addr().String(), getTLSConfig(ln) != nil))</code></span>
<span class="codeline" id="line-221"><code></code></span>
<span class="codeline" id="line-222"><code>	// Print startup message</code></span>
<span class="codeline" id="line-223"><code>	if !app.config.DisableStartupMessage {</code></span>
<span class="codeline" id="line-224"><code>		app.startupMessage(ln.Addr().String(), true, "")</code></span>
<span class="codeline" id="line-225"><code>	}</code></span>
<span class="codeline" id="line-226"><code></code></span>
<span class="codeline" id="line-227"><code>	// Print routes</code></span>
<span class="codeline" id="line-228"><code>	if app.config.EnablePrintRoutes {</code></span>
<span class="codeline" id="line-229"><code>		app.printRoutesMessage()</code></span>
<span class="codeline" id="line-230"><code>	}</code></span>
<span class="codeline" id="line-231"><code></code></span>
<span class="codeline" id="line-232"><code>	// Attach the tlsHandler to the config</code></span>
<span class="codeline" id="line-233"><code>	app.SetTLSHandler(tlsHandler)</code></span>
<span class="codeline" id="line-234"><code></code></span>
<span class="codeline" id="line-235"><code>	// Start listening</code></span>
<span class="codeline" id="line-236"><code>	return app.server.Serve(ln)</code></span>
<span class="codeline" id="line-237"><code>}</code></span>
<span class="codeline" id="line-238"><code></code></span>
<span class="codeline" id="line-239"><code>// prepareListenData create an slice of ListenData</code></span>
<span class="codeline" id="line-240"><code>func (app *App) prepareListenData(addr string, isTLS bool) ListenData { //revive:disable-line:flag-parameter // Accepting a bool param named isTLS if fine here</code></span>
<span class="codeline" id="line-241"><code>	host, port := parseAddr(addr)</code></span>
<span class="codeline" id="line-242"><code>	if host == "" {</code></span>
<span class="codeline" id="line-243"><code>		if app.config.Network == NetworkTCP6 {</code></span>
<span class="codeline" id="line-244"><code>			host = "[::1]"</code></span>
<span class="codeline" id="line-245"><code>		} else {</code></span>
<span class="codeline" id="line-246"><code>			host = globalIpv4Addr</code></span>
<span class="codeline" id="line-247"><code>		}</code></span>
<span class="codeline" id="line-248"><code>	}</code></span>
<span class="codeline" id="line-249"><code></code></span>
<span class="codeline" id="line-250"><code>	return ListenData{</code></span>
<span class="codeline" id="line-251"><code>		Host: host,</code></span>
<span class="codeline" id="line-252"><code>		Port: port,</code></span>
<span class="codeline" id="line-253"><code>		TLS:  isTLS,</code></span>
<span class="codeline" id="line-254"><code>	}</code></span>
<span class="codeline" id="line-255"><code>}</code></span>
<span class="codeline" id="line-256"><code></code></span>
<span class="codeline" id="line-257"><code>// startupMessage prepares the startup message with the handler number, port, address and other information</code></span>
<span class="codeline" id="line-258"><code>func (app *App) startupMessage(addr string, isTLS bool, pids string) { //nolint: revive // Accepting a bool param named isTLS if fine here</code></span>
<span class="codeline" id="line-259"><code>	// ignore child processes</code></span>
<span class="codeline" id="line-260"><code>	if IsChild() {</code></span>
<span class="codeline" id="line-261"><code>		return</code></span>
<span class="codeline" id="line-262"><code>	}</code></span>
<span class="codeline" id="line-263"><code></code></span>
<span class="codeline" id="line-264"><code>	// Alias colors</code></span>
<span class="codeline" id="line-265"><code>	colors := app.config.ColorScheme</code></span>
<span class="codeline" id="line-266"><code></code></span>
<span class="codeline" id="line-267"><code>	value := func(s string, width int) string {</code></span>
<span class="codeline" id="line-268"><code>		pad := width - len(s)</code></span>
<span class="codeline" id="line-269"><code>		str := ""</code></span>
<span class="codeline" id="line-270"><code>		for i := 0; i &lt; pad; i++ {</code></span>
<span class="codeline" id="line-271"><code>			str += "."</code></span>
<span class="codeline" id="line-272"><code>		}</code></span>
<span class="codeline" id="line-273"><code>		if s == "Disabled" {</code></span>
<span class="codeline" id="line-274"><code>			str += " " + s</code></span>
<span class="codeline" id="line-275"><code>		} else {</code></span>
<span class="codeline" id="line-276"><code>			str += fmt.Sprintf(" %s%s%s", colors.Cyan, s, colors.Black)</code></span>
<span class="codeline" id="line-277"><code>		}</code></span>
<span class="codeline" id="line-278"><code>		return str</code></span>
<span class="codeline" id="line-279"><code>	}</code></span>
<span class="codeline" id="line-280"><code></code></span>
<span class="codeline" id="line-281"><code>	center := func(s string, width int) string {</code></span>
<span class="codeline" id="line-282"><code>		const padDiv = 2</code></span>
<span class="codeline" id="line-283"><code>		pad := strconv.Itoa((width - len(s)) / padDiv)</code></span>
<span class="codeline" id="line-284"><code>		str := fmt.Sprintf("%"+pad+"s", " ")</code></span>
<span class="codeline" id="line-285"><code>		str += s</code></span>
<span class="codeline" id="line-286"><code>		str += fmt.Sprintf("%"+pad+"s", " ")</code></span>
<span class="codeline" id="line-287"><code>		if len(str) &lt; width {</code></span>
<span class="codeline" id="line-288"><code>			str += " "</code></span>
<span class="codeline" id="line-289"><code>		}</code></span>
<span class="codeline" id="line-290"><code>		return str</code></span>
<span class="codeline" id="line-291"><code>	}</code></span>
<span class="codeline" id="line-292"><code></code></span>
<span class="codeline" id="line-293"><code>	centerValue := func(s string, width int) string {</code></span>
<span class="codeline" id="line-294"><code>		const padDiv = 2</code></span>
<span class="codeline" id="line-295"><code>		pad := strconv.Itoa((width - runewidth.StringWidth(s)) / padDiv)</code></span>
<span class="codeline" id="line-296"><code>		str := fmt.Sprintf("%"+pad+"s", " ")</code></span>
<span class="codeline" id="line-297"><code>		str += fmt.Sprintf("%s%s%s", colors.Cyan, s, colors.Black)</code></span>
<span class="codeline" id="line-298"><code>		str += fmt.Sprintf("%"+pad+"s", " ")</code></span>
<span class="codeline" id="line-299"><code>		if runewidth.StringWidth(s)-10 &lt; width &amp;&amp; runewidth.StringWidth(s)%2 == 0 {</code></span>
<span class="codeline" id="line-300"><code>			// add an ending space if the length of str is even and str is not too long</code></span>
<span class="codeline" id="line-301"><code>			str += " "</code></span>
<span class="codeline" id="line-302"><code>		}</code></span>
<span class="codeline" id="line-303"><code>		return str</code></span>
<span class="codeline" id="line-304"><code>	}</code></span>
<span class="codeline" id="line-305"><code></code></span>
<span class="codeline" id="line-306"><code>	pad := func(s string, width int) string {</code></span>
<span class="codeline" id="line-307"><code>		toAdd := width - len(s)</code></span>
<span class="codeline" id="line-308"><code>		str := s</code></span>
<span class="codeline" id="line-309"><code>		for i := 0; i &lt; toAdd; i++ {</code></span>
<span class="codeline" id="line-310"><code>			str += " "</code></span>
<span class="codeline" id="line-311"><code>		}</code></span>
<span class="codeline" id="line-312"><code>		return str</code></span>
<span class="codeline" id="line-313"><code>	}</code></span>
<span class="codeline" id="line-314"><code></code></span>
<span class="codeline" id="line-315"><code>	host, port := parseAddr(addr)</code></span>
<span class="codeline" id="line-316"><code>	if host == "" {</code></span>
<span class="codeline" id="line-317"><code>		if app.config.Network == NetworkTCP6 {</code></span>
<span class="codeline" id="line-318"><code>			host = "[::1]"</code></span>
<span class="codeline" id="line-319"><code>		} else {</code></span>
<span class="codeline" id="line-320"><code>			host = globalIpv4Addr</code></span>
<span class="codeline" id="line-321"><code>		}</code></span>
<span class="codeline" id="line-322"><code>	}</code></span>
<span class="codeline" id="line-323"><code></code></span>
<span class="codeline" id="line-324"><code>	scheme := schemeHTTP</code></span>
<span class="codeline" id="line-325"><code>	if isTLS {</code></span>
<span class="codeline" id="line-326"><code>		scheme = schemeHTTPS</code></span>
<span class="codeline" id="line-327"><code>	}</code></span>
<span class="codeline" id="line-328"><code></code></span>
<span class="codeline" id="line-329"><code>	isPrefork := "Disabled"</code></span>
<span class="codeline" id="line-330"><code>	if app.config.Prefork {</code></span>
<span class="codeline" id="line-331"><code>		isPrefork = "Enabled"</code></span>
<span class="codeline" id="line-332"><code>	}</code></span>
<span class="codeline" id="line-333"><code></code></span>
<span class="codeline" id="line-334"><code>	procs := strconv.Itoa(runtime.GOMAXPROCS(0))</code></span>
<span class="codeline" id="line-335"><code>	if !app.config.Prefork {</code></span>
<span class="codeline" id="line-336"><code>		procs = "1"</code></span>
<span class="codeline" id="line-337"><code>	}</code></span>
<span class="codeline" id="line-338"><code></code></span>
<span class="codeline" id="line-339"><code>	const lineLen = 49</code></span>
<span class="codeline" id="line-340"><code>	mainLogo := colors.Black + " ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n"</code></span>
<span class="codeline" id="line-341"><code>	if app.config.AppName != "" {</code></span>
<span class="codeline" id="line-342"><code>		mainLogo += " ‚îÇ " + centerValue(app.config.AppName, lineLen) + " ‚îÇ\n"</code></span>
<span class="codeline" id="line-343"><code>	}</code></span>
<span class="codeline" id="line-344"><code>	mainLogo += " ‚îÇ " + centerValue("Fiber v"+Version, lineLen) + " ‚îÇ\n"</code></span>
<span class="codeline" id="line-345"><code></code></span>
<span class="codeline" id="line-346"><code>	if host == globalIpv4Addr {</code></span>
<span class="codeline" id="line-347"><code>		mainLogo += " ‚îÇ " + center(fmt.Sprintf("%s://127.0.0.1:%s", scheme, port), lineLen) + " ‚îÇ\n" +</code></span>
<span class="codeline" id="line-348"><code>			" ‚îÇ " + center(fmt.Sprintf("(bound on host 0.0.0.0 and port %s)", port), lineLen) + " ‚îÇ\n"</code></span>
<span class="codeline" id="line-349"><code>	} else {</code></span>
<span class="codeline" id="line-350"><code>		mainLogo += " ‚îÇ " + center(fmt.Sprintf("%s://%s:%s", scheme, host, port), lineLen) + " ‚îÇ\n"</code></span>
<span class="codeline" id="line-351"><code>	}</code></span>
<span class="codeline" id="line-352"><code></code></span>
<span class="codeline" id="line-353"><code>	mainLogo += fmt.Sprintf(</code></span>
<span class="codeline" id="line-354"><code>		" ‚îÇ                                                   ‚îÇ\n"+</code></span>
<span class="codeline" id="line-355"><code>			" ‚îÇ Handlers %s  Processes %s ‚îÇ\n"+</code></span>
<span class="codeline" id="line-356"><code>			" ‚îÇ Prefork .%s  PID ....%s ‚îÇ\n"+</code></span>
<span class="codeline" id="line-357"><code>			" ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"+</code></span>
<span class="codeline" id="line-358"><code>			colors.Reset,</code></span>
<span class="codeline" id="line-359"><code>		value(strconv.Itoa(int(app.handlersCount)), 14), value(procs, 12),</code></span>
<span class="codeline" id="line-360"><code>		value(isPrefork, 14), value(strconv.Itoa(os.Getpid()), 14),</code></span>
<span class="codeline" id="line-361"><code>	)</code></span>
<span class="codeline" id="line-362"><code></code></span>
<span class="codeline" id="line-363"><code>	var childPidsLogo string</code></span>
<span class="codeline" id="line-364"><code>	if app.config.Prefork {</code></span>
<span class="codeline" id="line-365"><code>		var childPidsTemplate string</code></span>
<span class="codeline" id="line-366"><code>		childPidsTemplate += "%s"</code></span>
<span class="codeline" id="line-367"><code>		childPidsTemplate += " ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n%s"</code></span>
<span class="codeline" id="line-368"><code>		childPidsTemplate += " ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"</code></span>
<span class="codeline" id="line-369"><code>		childPidsTemplate += "%s"</code></span>
<span class="codeline" id="line-370"><code></code></span>
<span class="codeline" id="line-371"><code>		newLine := " ‚îÇ %s%s%s ‚îÇ"</code></span>
<span class="codeline" id="line-372"><code></code></span>
<span class="codeline" id="line-373"><code>		// Turn the `pids` variable (in the form ",a,b,c,d,e,f,etc") into a slice of PIDs</code></span>
<span class="codeline" id="line-374"><code>		var pidSlice []string</code></span>
<span class="codeline" id="line-375"><code>		for _, v := range strings.Split(pids, ",") {</code></span>
<span class="codeline" id="line-376"><code>			if v != "" {</code></span>
<span class="codeline" id="line-377"><code>				pidSlice = append(pidSlice, v)</code></span>
<span class="codeline" id="line-378"><code>			}</code></span>
<span class="codeline" id="line-379"><code>		}</code></span>
<span class="codeline" id="line-380"><code></code></span>
<span class="codeline" id="line-381"><code>		var lines []string</code></span>
<span class="codeline" id="line-382"><code>		thisLine := "Child PIDs ... "</code></span>
<span class="codeline" id="line-383"><code>		var itemsOnThisLine []string</code></span>
<span class="codeline" id="line-384"><code></code></span>
<span class="codeline" id="line-385"><code>		const maxLineLen = 49</code></span>
<span class="codeline" id="line-386"><code></code></span>
<span class="codeline" id="line-387"><code>		addLine := func() {</code></span>
<span class="codeline" id="line-388"><code>			lines = append(lines,</code></span>
<span class="codeline" id="line-389"><code>				fmt.Sprintf(</code></span>
<span class="codeline" id="line-390"><code>					newLine,</code></span>
<span class="codeline" id="line-391"><code>					colors.Black,</code></span>
<span class="codeline" id="line-392"><code>					thisLine+colors.Cyan+pad(strings.Join(itemsOnThisLine, ", "), maxLineLen-len(thisLine)),</code></span>
<span class="codeline" id="line-393"><code>					colors.Black,</code></span>
<span class="codeline" id="line-394"><code>				),</code></span>
<span class="codeline" id="line-395"><code>			)</code></span>
<span class="codeline" id="line-396"><code>		}</code></span>
<span class="codeline" id="line-397"><code></code></span>
<span class="codeline" id="line-398"><code>		for _, pid := range pidSlice {</code></span>
<span class="codeline" id="line-399"><code>			if len(thisLine+strings.Join(append(itemsOnThisLine, pid), ", ")) &gt; maxLineLen {</code></span>
<span class="codeline" id="line-400"><code>				addLine()</code></span>
<span class="codeline" id="line-401"><code>				thisLine = ""</code></span>
<span class="codeline" id="line-402"><code>				itemsOnThisLine = []string{pid}</code></span>
<span class="codeline" id="line-403"><code>			} else {</code></span>
<span class="codeline" id="line-404"><code>				itemsOnThisLine = append(itemsOnThisLine, pid)</code></span>
<span class="codeline" id="line-405"><code>			}</code></span>
<span class="codeline" id="line-406"><code>		}</code></span>
<span class="codeline" id="line-407"><code></code></span>
<span class="codeline" id="line-408"><code>		// Add left over items to their own line</code></span>
<span class="codeline" id="line-409"><code>		if len(itemsOnThisLine) != 0 {</code></span>
<span class="codeline" id="line-410"><code>			addLine()</code></span>
<span class="codeline" id="line-411"><code>		}</code></span>
<span class="codeline" id="line-412"><code></code></span>
<span class="codeline" id="line-413"><code>		// Form logo</code></span>
<span class="codeline" id="line-414"><code>		childPidsLogo = fmt.Sprintf(childPidsTemplate,</code></span>
<span class="codeline" id="line-415"><code>			colors.Black,</code></span>
<span class="codeline" id="line-416"><code>			strings.Join(lines, "\n")+"\n",</code></span>
<span class="codeline" id="line-417"><code>			colors.Reset,</code></span>
<span class="codeline" id="line-418"><code>		)</code></span>
<span class="codeline" id="line-419"><code>	}</code></span>
<span class="codeline" id="line-420"><code></code></span>
<span class="codeline" id="line-421"><code>	// Combine both the child PID logo and the main Fiber logo</code></span>
<span class="codeline" id="line-422"><code></code></span>
<span class="codeline" id="line-423"><code>	// Pad the shorter logo to the length of the longer one</code></span>
<span class="codeline" id="line-424"><code>	splitMainLogo := strings.Split(mainLogo, "\n")</code></span>
<span class="codeline" id="line-425"><code>	splitChildPidsLogo := strings.Split(childPidsLogo, "\n")</code></span>
<span class="codeline" id="line-426"><code></code></span>
<span class="codeline" id="line-427"><code>	mainLen := len(splitMainLogo)</code></span>
<span class="codeline" id="line-428"><code>	childLen := len(splitChildPidsLogo)</code></span>
<span class="codeline" id="line-429"><code></code></span>
<span class="codeline" id="line-430"><code>	if mainLen &gt; childLen {</code></span>
<span class="codeline" id="line-431"><code>		diff := mainLen - childLen</code></span>
<span class="codeline" id="line-432"><code>		for i := 0; i &lt; diff; i++ {</code></span>
<span class="codeline" id="line-433"><code>			splitChildPidsLogo = append(splitChildPidsLogo, "")</code></span>
<span class="codeline" id="line-434"><code>		}</code></span>
<span class="codeline" id="line-435"><code>	} else {</code></span>
<span class="codeline" id="line-436"><code>		diff := childLen - mainLen</code></span>
<span class="codeline" id="line-437"><code>		for i := 0; i &lt; diff; i++ {</code></span>
<span class="codeline" id="line-438"><code>			splitMainLogo = append(splitMainLogo, "")</code></span>
<span class="codeline" id="line-439"><code>		}</code></span>
<span class="codeline" id="line-440"><code>	}</code></span>
<span class="codeline" id="line-441"><code></code></span>
<span class="codeline" id="line-442"><code>	// Combine the two logos, line by line</code></span>
<span class="codeline" id="line-443"><code>	output := "\n"</code></span>
<span class="codeline" id="line-444"><code>	for i := range splitMainLogo {</code></span>
<span class="codeline" id="line-445"><code>		output += colors.Black + splitMainLogo[i] + " " + splitChildPidsLogo[i] + "\n"</code></span>
<span class="codeline" id="line-446"><code>	}</code></span>
<span class="codeline" id="line-447"><code></code></span>
<span class="codeline" id="line-448"><code>	out := colorable.NewColorableStdout()</code></span>
<span class="codeline" id="line-449"><code>	if os.Getenv("TERM") == "dumb" || os.Getenv("NO_COLOR") == "1" || (!isatty.IsTerminal(os.Stdout.Fd()) &amp;&amp; !isatty.IsCygwinTerminal(os.Stdout.Fd())) {</code></span>
<span class="codeline" id="line-450"><code>		out = colorable.NewNonColorable(os.Stdout)</code></span>
<span class="codeline" id="line-451"><code>	}</code></span>
<span class="codeline" id="line-452"><code></code></span>
<span class="codeline" id="line-453"><code>	_, _ = fmt.Fprintln(out, output)</code></span>
<span class="codeline" id="line-454"><code>}</code></span>
<span class="codeline" id="line-455"><code></code></span>
<span class="codeline" id="line-456"><code>// printRoutesMessage print all routes with method, path, name and handlers</code></span>
<span class="codeline" id="line-457"><code>// in a format of table, like this:</code></span>
<span class="codeline" id="line-458"><code>// method | path | name      | handlers</code></span>
<span class="codeline" id="line-459"><code>// GET    | /    | routeName | github.com/gofiber/fiber/v2.emptyHandler</code></span>
<span class="codeline" id="line-460"><code>// HEAD   | /    |           | github.com/gofiber/fiber/v2.emptyHandler</code></span>
<span class="codeline" id="line-461"><code>func (app *App) printRoutesMessage() {</code></span>
<span class="codeline" id="line-462"><code>	// ignore child processes</code></span>
<span class="codeline" id="line-463"><code>	if IsChild() {</code></span>
<span class="codeline" id="line-464"><code>		return</code></span>
<span class="codeline" id="line-465"><code>	}</code></span>
<span class="codeline" id="line-466"><code></code></span>
<span class="codeline" id="line-467"><code>	// Alias colors</code></span>
<span class="codeline" id="line-468"><code>	colors := app.config.ColorScheme</code></span>
<span class="codeline" id="line-469"><code></code></span>
<span class="codeline" id="line-470"><code>	var routes []RouteMessage</code></span>
<span class="codeline" id="line-471"><code>	for _, routeStack := range app.stack {</code></span>
<span class="codeline" id="line-472"><code>		for _, route := range routeStack {</code></span>
<span class="codeline" id="line-473"><code>			var newRoute RouteMessage</code></span>
<span class="codeline" id="line-474"><code>			newRoute.name = route.Name</code></span>
<span class="codeline" id="line-475"><code>			newRoute.method = route.Method</code></span>
<span class="codeline" id="line-476"><code>			newRoute.path = route.Path</code></span>
<span class="codeline" id="line-477"><code>			for _, handler := range route.Handlers {</code></span>
<span class="codeline" id="line-478"><code>				newRoute.handlers += runtime.FuncForPC(reflect.ValueOf(handler).Pointer()).Name() + " "</code></span>
<span class="codeline" id="line-479"><code>			}</code></span>
<span class="codeline" id="line-480"><code>			routes = append(routes, newRoute)</code></span>
<span class="codeline" id="line-481"><code>		}</code></span>
<span class="codeline" id="line-482"><code>	}</code></span>
<span class="codeline" id="line-483"><code></code></span>
<span class="codeline" id="line-484"><code>	out := colorable.NewColorableStdout()</code></span>
<span class="codeline" id="line-485"><code>	if os.Getenv("TERM") == "dumb" || os.Getenv("NO_COLOR") == "1" || (!isatty.IsTerminal(os.Stdout.Fd()) &amp;&amp; !isatty.IsCygwinTerminal(os.Stdout.Fd())) {</code></span>
<span class="codeline" id="line-486"><code>		out = colorable.NewNonColorable(os.Stdout)</code></span>
<span class="codeline" id="line-487"><code>	}</code></span>
<span class="codeline" id="line-488"><code></code></span>
<span class="codeline" id="line-489"><code>	w := tabwriter.NewWriter(out, 1, 1, 1, ' ', 0)</code></span>
<span class="codeline" id="line-490"><code>	// Sort routes by path</code></span>
<span class="codeline" id="line-491"><code>	sort.Slice(routes, func(i, j int) bool {</code></span>
<span class="codeline" id="line-492"><code>		return routes[i].path &lt; routes[j].path</code></span>
<span class="codeline" id="line-493"><code>	})</code></span>
<span class="codeline" id="line-494"><code></code></span>
<span class="codeline" id="line-495"><code>	_, _ = fmt.Fprintf(w, "%smethod\t%s| %spath\t%s| %sname\t%s| %shandlers\t%s\n", colors.Blue, colors.White, colors.Green, colors.White, colors.Cyan, colors.White, colors.Yellow, colors.Reset)</code></span>
<span class="codeline" id="line-496"><code>	_, _ = fmt.Fprintf(w, "%s------\t%s| %s----\t%s| %s----\t%s| %s--------\t%s\n", colors.Blue, colors.White, colors.Green, colors.White, colors.Cyan, colors.White, colors.Yellow, colors.Reset)</code></span>
<span class="codeline" id="line-497"><code>	for _, route := range routes {</code></span>
<span class="codeline" id="line-498"><code>		_, _ = fmt.Fprintf(w, "%s%s\t%s| %s%s\t%s| %s%s\t%s| %s%s%s\n", colors.Blue, route.method, colors.White, colors.Green, route.path, colors.White, colors.Cyan, route.name, colors.White, colors.Yellow, route.handlers, colors.Reset)</code></span>
<span class="codeline" id="line-499"><code>	}</code></span>
<span class="codeline" id="line-500"><code></code></span>
<span class="codeline" id="line-501"><code>	_ = w.Flush() //nolint:errcheck // It is fine to ignore the error here</code></span>
<span class="codeline" id="line-502"><code>}</code></span>
</pre><pre id="footer">
<table><tr><td><img src="../../../../../png/go101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/apps-and-libs/golds.html"><b>Golds</b></a> <i>v0.6.8</i>. (GOOS=linux GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/go100and1">@Go100and1</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table></pre>